FROM node:18-alpine

ARG USERNAME
ARG PASSWORD
ARG PORT
ARG MONGO_HOST
ARG MONGO_PORT
ARG POSTGRES_HOST
ARG POSTGRES_PORT

ENV APP_PORT $PORT
ENV DB_USER $USERNAME
ENV DB_PASSWORD $PASSWORD
ENV DB_NAME fdc
ENV DB_MONGO_HOST $MONGO_HOST
ENV DB_MONGO_PORT $MONGO_PORT
ENV DB_POSTGRES_HOST $POSTGRES_HOST
ENV DB_POSTGRES_PORT $POSTGRES_PORT

WORKDIR /usr/src/app

COPY . .

RUN npm install --ignore-scripts
RUN npm run build

EXPOSE $PORT
CMD npm start
